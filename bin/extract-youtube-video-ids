#!perl

# DATE
# VERSION

use 5.010;
use strict;
use warnings;

#use App::PMUtils;
use Perinci::CmdLine::Any;

our %SPEC;

$SPEC{extract_youtube_video_ids} = {
    v => 1.1,
    summary => 'Extract YouTube video IDs from filename/URL '.
        '(in arguments/stdin)',
    args => {
        args => {
            schema => ['array*', of=>'str*'],
            req => 1,
            pos => 0,
            cmdline_src => 'stdin_or_args',
        },
    },
    result_naked => 1,
    examples => [
        {
            argv => [
                'https://www.youtube.com/watch?v=rp4UwPZfRis',
                '$100,000 Name That Tune - Nick vs. Carol-SY-DnVZeFH0.mp4',
                'GNdALsnBjh8',
            ],
            result => [
                'rp4UwPZfRis',
                'SY-DnVZeFH0',
                'GNdALsnBjh8',
            ],
        },
    ],
};
sub extract_youtube_video_ids {
    my %args = @_;

    my $re = qr/(?:[A-Za-z0-9_-]{11})/;
    my @res;
    for my $arg (@{ $args{args} }) {
        if ($arg =~ /\A$re\z/) {
            push @res, $arg;
        } elsif ($arg =~ m!\Ahttps?://! &&
                     $arg =~ /=($re)(?:&|\#|\z)/) {
            push @res, $1;
        } else {
            # assume it's a filename like that generated by youtube-dl
            if (/-($re)\.\w+\z/) {
                push @res, $1;
            }
        }
    }
    \@res;
}

Perinci::CmdLine::Any->new(
    url => "/main/extract_youtube_video_ids",
)->run;

# ABSTRACT:
# PODNAME:
